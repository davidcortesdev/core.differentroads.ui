<!-- NUEVO: Estados de carga y error -->
<div class="loading-container" *ngIf="loading">
  <p-progressSpinner styleClass="summary-loader"></p-progressSpinner>
  <p>Cargando resumen del pedido...</p>
  
</div>

<div *ngIf="error && !loading" class="error-container">
  <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: #f05a4c"></i>
  <p>Error al cargar el resumen del pedido</p>
  <p-button 
    label="Reintentar" 
    icon="pi pi-refresh" 
    size="small"
    (onClick)="refreshSummary()">
  </p-button>
</div>

<!-- Contenido existente con *ngIf="!loading && !error" -->
<div class="order-summary" [ngClass]="customClass" *ngIf="!loading && !error">
  <h3 *ngIf="showTitle">{{ title }}</h3>
  <div class="summary-content">
    <!-- Tour base info -->
    <div class="tour-base-info">
      <!-- Selected items list -->
      <div class="selected-items">
        <div
          *ngFor="let item of summary"
          class="item"
          [ngClass]="{ discount: isDiscount(item) }"
        >
          <span class="description">{{ getDescription(item) }}</span>
          <span class="value-container">
            <!-- Mostrar "Incluido" para seguros básicos incluidos -->
            <span *ngIf="isBasicInsuranceIncluded(item)" class="included-text">
              Incluido
            </span>
            <!-- Mostrar cantidad y precio para otros items -->
            <span *ngIf="!isBasicInsuranceIncluded(item)">
              <span class="qty">{{ getQuantity(item) }}</span>
              <span class="operator">x</span>
              <span class="unit-price">{{
                getValue(item) | currencyFormat : currency
              }}</span>
              <span class="operator">=</span>
              <span class="total-price">{{
                calculateTotal(item) | currencyFormat : currency
              }}</span>
            </span>
          </span>
        </div>
      </div>

      <!-- Points section -->
      <br *ngIf="showPointsSection" /><br *ngIf="showPointsSection" />
      <div class="points-section" *ngIf="showPointsSection">
        <div *ngIf="isAuthenticated; else notAuthenticated">
          <p>Acumulas {{ getEarnedPoints() }} puntos con este viaje</p>
          <p-message
            severity="secondary"
            size="small"
            icon="pi pi-exclamation-circle"
          >
            Se genera un abono del 3% del importe del viaje en puntos a
            descontar en futuras compras.
          </p-message>
        </div>

        <ng-template #notAuthenticated>
          <p-message severity="warn" size="small" icon="pi pi-info-circle">
            Para acumular puntos, es necesario iniciar sesión.
          </p-message>
        </ng-template>
      </div>
      <!-- Total section -->
      <div class="total-section" *ngIf="showTotalSection">
        <div class="total">
          <span>{{ totalLabel }}</span>
          <span class="price">{{ total | currencyFormat : currency }}</span>
        </div>
      </div>
      <!-- Flights info if selected -->
      <app-flight-section-v2
        *ngIf="
          showFlightSection &&
          selectedFlight
        "
        [flightPack]="selectedFlight"
      >
      </app-flight-section-v2>
    </div>
  </div>
</div>
