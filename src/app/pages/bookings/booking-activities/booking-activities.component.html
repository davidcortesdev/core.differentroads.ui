<div class="activities-container">
  <p-panel header="Actividades">
    <p-dataview #dv [value]="availableActivities" [emptyMessage]="''">
      <ng-template #list let-items>
        <div class="activities-content">
          <div *ngFor="let activity of items" class="activity-item">
            <div class="activity-content">
              <div class="activity-image">
                <img [src]="activity.imageUrl" [alt]="activity.title" />
              </div>
              <div class="activity-details">
                <div class="activity-header">
                  <div class="activity-title-container">
                    <span *ngIf="activity.isOptional" class="optional-label"
                      >Opcional:</span
                    >
                    <span class="activity-title">{{ activity.title }}</span>
                  </div>
                  <div class="activity-price">
                    <span class="price-value"
                      >+{{ activity.price | currencyFormat }}</span
                    >
                    <span *ngIf="activity.perPerson" class="per-person"
                      >por persona</span
                    >
                  </div>
                </div>
                <div
                  class="activity-description"
                  [innerHTML]="getSafeDescription(activity.description)"
                ></div>
                <div class="activity-actions">
                  <button
                    *ngIf="
                      activity.isOptional &&
                      !activity.showPassengers &&
                      !activity.isIncluded
                    "
                    pButton
                    type="button"
                    label="Añadir"
                    class="p-button-rounded"
                    (click)="toggleAddActivity(activity.id)"
                  ></button>
                  <button
                    *ngIf="
                      activity.isOptional &&
                      (activity.showPassengers || activity.isIncluded)
                    "
                    pButton
                    type="button"
                    label="Añadida"
                    class="p-button-rounded p-button-outlined"
                    (click)="toggleAddActivity(activity.id)"
                    [disabled]="!activity.addedManually"
                  ></button>
                </div>
                <div *ngIf="activity.showPassengers" class="passengers-section">
                  <h4>Selecciona los pasajeros:</h4>
                  <div
                    *ngFor="let traveler of activity.selectedTravelers"
                    class="passenger-item"
                  >
                    <p-toggleswitch
                      [(ngModel)]="traveler.selected"
                      [disabled]="traveler.price === 0"
                    ></p-toggleswitch>
                    <span
                      >{{ getTravelerNameById(traveler.id) }} ({{
                        traveler.ageGroup
                      }})
                      <span *ngIf="traveler.price > 0" class="price-text"
                        >+{{ traveler.price | currencyFormat }}</span
                      >
                      <span *ngIf="traveler.price === 0">(No disponible)</span>
                    </span>
                  </div>
                  <div class="">
                    <button
                      pButton
                      type="button"
                      [label]="isLoading ? 'Cargando...' : 'Continuar'"
                      (click)="onContinueActivity(activity.id)"
                      class="p-button-rounded"
                      [disabled]="isLoading"
                      [icon]="isLoading ? 'pi pi-spin pi-spinner' : ''"
                      [iconPos]="isLoading ? 'left' : 'right'"
                    ></button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="items.length === 0" class="no-activities">
            No hay actividades disponibles para esta reserva.
          </div>
        </div>
      </ng-template>
    </p-dataview>
  </p-panel>
</div>
