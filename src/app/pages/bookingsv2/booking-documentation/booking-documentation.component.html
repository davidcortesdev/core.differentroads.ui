<div class="container">
  <div class="docs-container">
    <p-panel header="Documentación">
      <div *ngIf="documentsLoading" class="loading-container">
        <p-progressSpinner></p-progressSpinner>
        <p>Cargando documentos...</p>
      </div>

      <p-table
        *ngIf="!documentsLoading"
        [value]="apiDocuments"
        responsiveLayout="scroll"
        dataKey="id"
      >
        <ng-template #header>
          <tr>
            <th>Documento</th>
            <th>Tipo</th>
            <th>Fecha de creación</th>
            <th>Tamaño</th>
            <th style="width: 5rem">Acciones</th>
          </tr>
        </ng-template>

        <ng-template #body let-documentReservation>
          <tr>
            <td>
              {{ documentReservation.document?.fileName || "Sin nombre" }}
            </td>
            <td>
              <p-tag
                [value]="
                  getDocumentTypeText(
                    documentReservation.document?.documentTypeId
                  )
                "
                severity="info"
              >
              </p-tag>
            </td>
            <td>{{ formatDocumentDate(documentReservation.createdAt) }}</td>
            <td>
              {{
                documentReservation.document
                  ? (documentReservation.document.fileSize / 1024).toFixed(1) +
                    " KB"
                  : "N/A"
              }}
            </td>
            <td>
              <p-button
                icon="pi pi-download"
                severity="secondary"
                rounded
                [disabled]="true"
                pTooltip="Descarga no disponible"
              >
              </p-button>
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="5">No hay documentos disponibles.</td>
          </tr>
        </ng-template>
      </p-table>
    </p-panel>
  </div>

  <div class="not-container">
    <p-panel header="Notificaciones">
      <div *ngIf="notificationsLoading" class="loading-container">
        <p-progressSpinner></p-progressSpinner>
        <p>Cargando notificaciones...</p>
      </div>

      <p-table
        *ngIf="!notificationsLoading"
        [value]="apiNotifications"
        responsiveLayout="scroll"
        dataKey="id"
      >
        <ng-template #header>
          <tr>
            <th>Tipo</th>
            <th>Fecha de envío</th>
          </tr>
        </ng-template>

        <ng-template #body let-notification>
          <tr>
            <td>
              {{ getNotificationTypeText(notification.notificationTypeId) }}
            </td>
            <td>{{ formatNotificationDate(notification.createdAt) }}</td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="2">No hay notificaciones registradas.</td>
          </tr>
        </ng-template>
      </p-table>
    </p-panel>
  </div>

  <div class="notes-container">
    <p-panel header="Notas">
      <p-table
        #dt
        [value]="notes"
        responsiveLayout="scroll"
        dataKey="_id"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} notas"
        [rowHover]="true"
        styleClass="p-datatable-gridlines p-datatable-sm"
        [globalFilterFields]="['message', 'type']"
      >
        <ng-template #header>
          <tr>
            <th pSortableColumn="createdAt">
              Fecha de creación <p-sortIcon field="createdAt"></p-sortIcon>
            </th>
            <th>Mensaje</th>
            <th>Estado</th>
          </tr>
        </ng-template>

        <ng-template #body let-note>
          <tr>
            <td>{{ note.createdAt | date : "short" }}</td>
            <td pTooltip="{{ note.message }}" tooltipPosition="top">
              {{ note.title }}
            </td>
            <td>
              <p-tag
                [value]="note.type"
                [severity]="getTypeSeverity(note.type)"
              ></p-tag>
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="3">No hay notas registradas.</td>
          </tr>
        </ng-template>
      </p-table>
    </p-panel>
  </div>
</div>
