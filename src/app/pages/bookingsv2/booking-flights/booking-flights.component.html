<!-- Two-column layout container -->
<div class="flight-container">
  <!-- Left column: Flight information -->
  <div class="flight-info-column">
    <p-panel [showHeader]="!hasValidFlightData()">
      <ng-template #header>
        <div>Vuelos</div>
      </ng-template>
      <!-- Mostrar componente de vuelo solo si hay información válida de vuelos -->
      <ng-container *ngIf="hasValidFlightData(); else noFlights">
        <app-flight-section-v2 [flightPack]="flightPackData"></app-flight-section-v2>
      </ng-container>
      <!-- Plantilla para cuando no hay información de vuelos -->
      <ng-template #noFlights>
        <div class="no-flights-message">
          <p>Sin vuelos</p>
        </div>
      </ng-template>
    </p-panel>
  </div>
  
  <!-- Right column: Flight identifiers -->
  <div class="flight-identifiers-column">
    <p-panel>
      <ng-template #header>
        <div>Identificadores de Vuelo</div>
      </ng-template>
      <ng-container *ngIf="hasValidFlightData(); else noIdentifiers">
        <div class="identifiers-content">
          <!-- Outbound flight identifiers -->
          <div class="flight-type-header">Vuelo de Ida</div>
          <ng-container *ngIf="flight.outbound?.segments && flight.outbound.segments.length > 0">
            <div *ngFor="let segment of flight.outbound.segments; let i = index" class="segment-identifier">
              <div class="identifier-item">
                <span class="identifier-label">Vuelo {{i+1}}:</span>
                <span class="identifier-value">{{segment.flightNumber}}</span>
              </div>
              <div class="identifier-item">
                <span class="identifier-label">Ruta:</span>
                <span class="identifier-value">{{segment.departureCity}} → {{segment.arrivalCity}}</span>
              </div>
            </div>
          </ng-container>
          
          <!-- Inbound flight identifiers -->
          <div class="flight-type-header" *ngIf="flight.inbound?.segments && flight.inbound.segments.length > 0">Vuelo de Vuelta</div>
          <ng-container *ngIf="flight.inbound?.segments && flight.inbound.segments.length > 0">
            <div *ngFor="let segment of flight.inbound.segments; let i = index" class="segment-identifier">
              <div class="identifier-item">
                <span class="identifier-label">Vuelo {{i+1}}:</span>
                <span class="identifier-value">{{segment.flightNumber}}</span>
              </div>
              <div class="identifier-item">
                <span class="identifier-label">Ruta:</span>
                <span class="identifier-value">{{segment.departureCity}} → {{segment.arrivalCity}}</span>
              </div>
            </div>
          </ng-container>
        </div>

        <!-- NUEVO: Botón para emitir vuelo del consolidador (solo para ATC cuando está PAID) -->
        <div class="flight-emission-section" *ngIf="shouldShowEmitButton">
          <div class="emission-button-container">
            <p-button
              label="Emitir vuelo"
              icon="pi pi-send"
              (onClick)="checkAndBookAmadeusFlight()"
              [disabled]="isEmitButtonDisabled"
              [loading]="flightBookingLoading"
              styleClass="emit-flight-button"
            >
            </p-button>
            <span class="last-ticketing-date" *ngIf="lastTicketingDate">
              Fecha límite: {{ formatLastTicketingDate() }}
            </span>
          </div>
        </div>

        <!-- NUEVO: Estado de carga durante la emisión -->
        <div class="flight-booking-loading" *ngIf="flightBookingLoading">
          <p-progressSpinner [style]="{ width: '30px', height: '30px' }"></p-progressSpinner>
          <p>Procesando emisión de vuelo...</p>
        </div>

        <!-- NUEVO: Respuesta exitosa de la reserva -->
        <div class="flight-booking-success" *ngIf="flightBookingResponse && !flightBookingError">
          <div class="success-message">
            <i class="pi pi-check-circle" style="color: var(--green-500); margin-right: 0.5rem"></i>
            <span>Vuelo emitido correctamente</span>
          </div>
        </div>

        <!-- NUEVO: Error en la reserva -->
        <div class="flight-booking-error" *ngIf="flightBookingError && !flightBookingLoading">
          <div class="error-message">
            <i class="pi pi-exclamation-triangle" style="color: var(--red-500); margin-right: 0.5rem"></i>
            <span>Error al emitir el vuelo. Por favor, contacta con soporte.</span>
          </div>
        </div>
      </ng-container>
      <!-- Plantilla para cuando no hay identificadores de vuelo -->
      <ng-template #noIdentifiers>
        <div class="no-flights-message">
          <p>Sin vuelos</p>
        </div>
      </ng-template>
    </p-panel>
  </div>
</div>