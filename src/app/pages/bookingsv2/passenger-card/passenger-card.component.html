<p-card styleClass="passenger-card-panel">
  <ng-template #header>
    <div class="passenger-header">
      <i class="pi pi-user"></i>
      <span class="passenger-type">{{
        getPassengerTypeLabel(passenger.type)
      }}</span>
    </div>
  </ng-template>

  <!-- View Mode -->
  <div class="passenger-content" *ngIf="!isEditing">
    <div class="detail-row hab" *ngIf="shouldShowField('room')">
      <span class="detail-label hab">Habitación:</span>
      <span
        class="detail-value hab"
        [ngClass]="{ 'pending-value': !passenger.room }"
        >{{ passenger.room || "Pendiente" }}</span
      >
    </div>

    <div class="passenger-details">
      <div class="passenger-name">
        <h3>{{ passenger.name }} {{ passenger.surname }}</h3>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('phone')">
        <span class="detail-label">Teléfono:</span>
        <span class="detail-value" *ngIf="passenger.phone">{{
          passenger.phone
        }}</span>
        <span class="detail-value" *ngIf="!passenger.phone">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('email')">
        <span class="detail-label">Email:</span>
        <span class="detail-value" *ngIf="passenger.email">{{
          passenger.email
        }}</span>
        <span class="detail-value" *ngIf="!passenger.email">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <p-divider
        *ngIf="shouldShowField('gender') || shouldShowField('birthDate')"
      ></p-divider>

      <div class="detail-row" *ngIf="shouldShowField('gender')">
        <span class="detail-label">
          Sexo:
          <span *ngIf="isFieldRequired('gender')" class="required-indicator">*</span>
        </span>
        <span class="detail-value" *ngIf="passenger.gender">
          {{ getGenderLabel(passenger.gender) }}
        </span>
        <span class="detail-value" *ngIf="!passenger.gender">
          <i
            class="pi pi-info-circle"
            [pTooltip]="isFieldRequired('gender') ? 'Este campo es obligatorio' : 'Este dato no es obligatorio para realizar la reserva'"
            [ngClass]="{ 'required-field': isFieldRequired('gender') }"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('birthDate')">
        <span class="detail-label">
          Fecha de nacimiento:
          <span *ngIf="isFieldRequired('birthDate')" class="required-indicator">*</span>
        </span>
        <span
          class="detail-value"
          [ngClass]="{ 
            'pending-value': !passenger.birthDate,
            'required-field': isFieldRequired('birthDate') && !passenger.birthDate
          }"
        >
          {{
            passenger.birthDate ? formatDate(passenger.birthDate) : "Pendiente"
          }}
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('ciudad')">
        <span class="detail-label">Ciudad:</span>
        <span class="detail-value" *ngIf="passenger.ciudad">{{
          passenger.ciudad
        }}</span>
        <span class="detail-value" *ngIf="!passenger.ciudad">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('codigoPostal')">
        <span class="detail-label">Código postal:</span>
        <span class="detail-value" *ngIf="passenger.codigoPostal">{{
          passenger.codigoPostal
        }}</span>
        <span class="detail-value" *ngIf="!passenger.codigoPostal">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('nationality')">
        <span class="detail-label">Nacionalidad:</span>
        <span
          class="detail-value"
          [ngClass]="{ 'pending-value': !passenger.nationality }"
          >{{ passenger.nationality || "Pendiente" }}</span
        >
      </div>

      <p-divider
        *ngIf="
          shouldShowField('dni') ||
          shouldShowField('minorIdIssueDate') ||
          shouldShowField('minorIdExpirationDate')
        "
      ></p-divider>

      <div class="detail-row" *ngIf="shouldShowField('dni')">
        <span class="detail-label">DNI:</span>
        <span class="detail-value" *ngIf="passenger.dni">{{
          passenger.dni
        }}</span>
        <span class="detail-value" *ngIf="!passenger.dni">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('minorIdIssueDate')">
        <span class="detail-label">Fecha de expedición DNI:</span>
        <span class="detail-value" *ngIf="passenger.minorIdIssueDate">
          {{ formatDate(passenger.minorIdIssueDate || "") }}
        </span>
        <span class="detail-value" *ngIf="!passenger.minorIdIssueDate">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('minorIdExpirationDate')">
        <span class="detail-label">Fecha de caducidad DNI:</span>
        <span class="detail-value" *ngIf="passenger.minorIdExpirationDate">
          {{ formatDate(passenger.minorIdExpirationDate || "") }}
        </span>
        <span class="detail-value" *ngIf="!passenger.minorIdExpirationDate">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <p-divider
        *ngIf="
          shouldShowField('passportID') ||
          shouldShowField('documentExpeditionDate') ||
          shouldShowField('documentExpirationDate')
        "
      ></p-divider>

      <div class="detail-row" *ngIf="shouldShowField('passportID')">
        <span class="detail-label">Pasaporte:</span>
        <span class="detail-value" *ngIf="passenger.passportID">{{
          passenger.passportID
        }}</span>
        <span class="detail-value" *ngIf="!passenger.passportID">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('documentExpeditionDate')">
        <span class="detail-label">Fecha de expedición:</span>
        <span
          class="detail-value"
          [ngClass]="{ 'pending-value': !passenger.documentExpeditionDate }"
        >
          {{
            passenger.documentExpeditionDate
              ? formatDate(passenger.documentExpeditionDate || "")
              : "Pendiente"
          }}
        </span>
      </div>

      <div class="detail-row" *ngIf="shouldShowField('documentExpirationDate')">
        <span class="detail-label">Fecha de caducidad:</span>
        <span class="detail-value" *ngIf="passenger.documentExpirationDate">
          {{ formatDate(passenger.documentExpirationDate || "") }}
        </span>
        <span class="detail-value" *ngIf="!passenger.documentExpirationDate">
          <i
            class="pi pi-info-circle"
            pTooltip="Este dato no es obligatorio para realizar la reserva"
          ></i>
        </span>
      </div>

      <p-divider *ngIf="shouldShowField('comfortPlan')"></p-divider>

      <div class="detail-row" *ngIf="shouldShowField('comfortPlan')">
        <span class="detail-label">Seguro:</span>
        <span class="detail-value">{{ getComfortPlanValue() }}</span>
      </div>
    </div>
  </div>

  <!-- Edit Mode -->
  <div class="passenger-content edit-mode" *ngIf="isEditing">
    <form [formGroup]="passengerForm">
      <div class="detail-row hab" *ngIf="shouldShowField('room')">
        <span class="detail-label hab">Habitación:</span>
        <span
          class="detail-value hab"
          [ngClass]="{ 'pending-value': !passenger.room }"
          >{{ passenger.room || "Pendiente" }}</span
        >
      </div>

      <div class="update-passenger-details">
        <div class="form-field" *ngIf="shouldShowField('name')">
          <label>Nombre:</label>
          <input
            pInputText
            formControlName="fullName"
            placeholder="Ingrese su nombre completo"
          />
        </div>
        <div class="form-field" *ngIf="shouldShowField('surname')">
          <label>Apellido:</label>
          <input
            pInputText
            formControlName="surname"
            placeholder="Ingrese su apellido completo"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('phone')">
          <label>Teléfono:</label>
          <input
            pInputText
            formControlName="phone"
            placeholder="Ingrese su teléfono"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('email')">
          <label>Email:</label>
          <input
            pInputText
            formControlName="email"
            placeholder="Ingrese su email"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('gender')">
          <label>Sexo:</label>
          <p-dropdown
            formControlName="gender"
            [options]="genderOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccione su sexo"
            [disabled]="!isEditing"
            styleClass="custom-dropdown"
            [showClear]="true"
            [autoDisplayFirst]="false"
          ></p-dropdown>
        </div>

        <div class="form-field" *ngIf="shouldShowField('birthDate')">
          <label>Fecha de nacimiento:</label>
          <p-datepicker
            formControlName="birthDate"
            placeholder="dd/mm/aaaa"
            [showIcon]="true"
            appendTo="body"
            dateFormat="dd/mm/yy"
            [maxDate]="today"
          ></p-datepicker>
        </div>

        <div class="form-field" *ngIf="shouldShowField('ciudad')">
          <label>Ciudad:</label>
          <input
            pInputText
            formControlName="ciudad"
            placeholder="Ingrese su ciudad"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('codigoPostal')">
          <label>Código postal:</label>
          <input
            pInputText
            formControlName="codigoPostal"
            placeholder="Ingrese su código postal"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('nationality')">
          <label>Nacionalidad</label>
          <input
            pInputText
            formControlName="nationality"
            placeholder="Ingrese su nacionalidad"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('dni')">
          <label>DNI:</label>
          <input
            pInputText
            formControlName="dni"
            placeholder="Ingrese su DNI"
          />
        </div>

        <div class="form-field" *ngIf="shouldShowField('minorIdIssueDate')">
          <label>Fecha de expedición DNI:</label>
          <p-datepicker
            formControlName="minorIdIssueDate"
            placeholder="dd/mm/aaaa"
            [showIcon]="true"
            appendTo="body"
            dateFormat="dd/mm/yy"
            [maxDate]="today"
          ></p-datepicker>
        </div>

        <div
          class="form-field"
          *ngIf="shouldShowField('minorIdExpirationDate')"
        >
          <label>Fecha de caducidad DNI:</label>
          <p-datepicker
            formControlName="minorIdExpirationDate"
            placeholder="dd/mm/aaaa"
            [showIcon]="true"
            appendTo="body"
            dateFormat="dd/mm/yy"
            [minDate]="today"
          ></p-datepicker>
        </div>

        <div class="form-field" *ngIf="shouldShowField('passportID')">
          <label>Pasaporte:</label>
          <input
            pInputText
            formControlName="passportID"
            placeholder="Ingrese N° pasaporte"
          />
        </div>

        <div
          class="form-field"
          *ngIf="shouldShowField('documentExpeditionDate')"
        >
          <label>Fecha de expedición:</label>
          <p-datepicker
            formControlName="documentExpeditionDate"
            placeholder="dd/mm/aaaa"
            [showIcon]="true"
            appendTo="body"
            dateFormat="dd/mm/yy"
            [maxDate]="today"
          ></p-datepicker>
        </div>

        <div
          class="form-field"
          *ngIf="shouldShowField('documentExpirationDate')"
        >
          <label>Fecha de caducidad:</label>
          <p-datepicker
            formControlName="documentExpirationDate"
            placeholder="dd/mm/aaaa"
            [showIcon]="true"
            appendTo="body"
            dateFormat="dd/mm/yy"
          ></p-datepicker>
        </div>

        <div class="detail-row" *ngIf="shouldShowField('comfortPlan')">
          <span class="detail-label">Seguro:</span>
          <span class="detail-value">{{ getComfortPlanValue() }}</span>
        </div>
      </div>
    </form>
  </div>

  <ng-template #footer>
    <div class="passenger-footer">
      <div
        *ngIf="!isEditing && hasPendingFields()"
        class="pending-fields-indicator"
      >
        <i class="pi pi-info-circle"></i>
        <span>Completa tus datos antes de tu viaje.</span>
      </div>

      <!-- This spacer ensures the edit button is always on the right, even if no pending indicator -->
      <div *ngIf="!isEditing && !hasPendingFields()" class="flex-spacer"></div>

      <!-- Edit button in view mode -->
      <div class="edit-button-container">
        <p-button
          *ngIf="!isEditing"
          icon="pi pi-pencil"
          styleClass="p-button-rounded p-button-text"
          pTooltip="Editar pasajero"
          (onClick)="onEdit()"
        >
        </p-button>
      </div>

      <!-- Save buttons in edit mode -->
      <div *ngIf="isEditing" class="edit-buttons">
        <p-button
          label="Guardar"
          icon="pi pi-check"
          styleClass="p-button-success"
          (onClick)="onSave()"
        >
        </p-button>
        <p-button
          icon="pi pi-times"
          styleClass="p-button-text p-button-danger ml-2 p-button-rounded"
          (onClick)="onCancel()"
        >
        </p-button>
      </div>
    </div>
  </ng-template>
</p-card>
