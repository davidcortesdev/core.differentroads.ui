<div class="flights">
  <div class="step">
    <div class="step-title">Elige tus vuelos</div>
    <div class="step-description">Vuelos disponibles</div>
  </div>

  <div class="flights-container">
    <div *ngFor="let flightPack of flightPacks">
      <div *ngIf="flightPack.totalPrice > 0" class="flight-item">
        <div class="flight-departure-title" *ngIf="flightPack">
          <h3>
            Salida {{ flightPack.flights[0].departureCity }} ({{
              flightPack.flights[0].departureIATACode
            }})
          </h3>
        </div>

        <div class="flight-itinerary">
          <div class="flight-itinerary-journey">
            <div class="journey-item" *ngFor="let flight of flightPack.flights; let i = index">
              <div class="journey-direction">
                <span class="direction-text">{{flight.flightTypeId === FLIGHT_TYPE_SALIDA ? "IDA" : "VUELTA"}}</span>
              </div>
              <div class="journey-row">
                <div class="journey-time-block departure">
                  <span class="journey-time">
                    {{ flight.departureTime ? (flight.departureTime.slice(0,5)) : '--:--' }}
                  </span>
                  <span class="journey-date">
                    {{flight.departureDate | date : "dd-MM-yyyy" : "UTC"}}
                  </span>
                  <span class="journey-city">({{ flight.departureIATACode }}) {{ flight.departureCity }}</span>
                </div>
                <div class="journey-line-left"></div>
                <div class="journey-info-block">
                  <div class="stops-container">      
                    <span class="journey-stops" (click)="op.toggle($event)">
                      {{ flightDetails.get(flight.id)?.numScales }} escalas
                    </span>
                    <div class="stops-underline"></div>
                    <p-overlayPanel #op>
                      <p class="panel-title">Detalle del vuelo</p>
                      <ng-container *ngIf="flightDetails.get(flight.id)?.segments as segments">
                        <ul>
                          <li *ngFor="let seg of segments">
                            {{ seg.departureCity }} ({{ seg.departureIata }}) {{ seg.departureTime.slice(0,5) || '--:--'}} â†’
                            {{ seg.arrivalCity }} ({{ seg.arrivalIata }}) {{ seg.arrivalTime.slice(0,5) || '--:--'}}
                            <span *ngIf="seg.flightNumber">| Vuelo: {{ seg.flightNumber }}</span>
                          </li>
                        </ul>
                      </ng-container>
                    </p-overlayPanel>
                  </div>
                  <span class="journey-airline">{{ flightDetails.get(flight.id)?.airlines?.join(', ') || '' }}</span>
                  <span class="journey-duration">{{ flightDetails.get(flight.id)?.duration || 0 }} horas</span>
                </div>
                <div class="journey-line-right"></div>
                <div class="journey-time-block arrival">
                  <span class="journey-time">
                    {{ flight.arrivalTime ? (flight.arrivalTime.slice(0,5)) : '--:--' }}
                  </span>
                  <span class="journey-date">
                    {{flight.arrivalDate | date : "dd-MM-yyyy" : "UTC"}}
                  </span>
                  <span class="journey-city">({{ flight.arrivalIATACode }}) {{ flight.arrivalCity }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="flight-itinerary-price space-y-4">
            <div class="flight-itinerary-price-wrapper">
              <span class="flight-itinerary-price-wrapper-price">
                {{ flightPack.totalPrice || 0 | currencyFormat : "EUR" }}
              </span>
              <span class="flight-itinerary-price-wrapper-text">Por persona</span>
            </div>
            <p-button
              type="button"
              class="button-rounded is-primary px-6 py-3"
              [styleClass]="selectedFlight === flightPack ? 'selected-flight-button' : ''"
              (click)="selectFlight(flightPack)"
            >
              {{ selectedFlight === flightPack ? "Seleccionado" : "Seleccionar" }}
            </p-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-login-modal
    [visible]="loginDialogVisible"
    (close)="closeLoginModal()"
    (login)="navigateToLogin()"
    (register)="navigateToRegister()"
  >
  </app-login-modal>
</div>
  