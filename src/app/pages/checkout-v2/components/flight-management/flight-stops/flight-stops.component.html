<!-- 
  Componente para mostrar las escalas de un vuelo específico.
  
  Parámetros:
  - flightId: ID del vuelo individual
  - packId: ID del paquete de vuelos (necesario para el nuevo endpoint)
  - useNewService: true para usar FlightSearchService, false para FlightsNetService
  
  El nuevo endpoint requiere tanto packId como flightId para obtener los detalles correctos.
-->
<div class="stops-container">      
    <span class="journey-stops" (click)="op.toggle($event)">
      {{ getFlightStopsText() }}
    </span>
    <div class="stops-underline"></div>
    <p-popover #op>
      <div class="flight-details-content">
        <div class="popover-header">
          <h4>Detalle del vuelo</h4>
        </div>
        
        <!-- Indicador de carga de ciudades -->
        <div *ngIf="!citiesLoaded && !isLoading" class="loading-cities">
          <i class="pi pi-spin pi-spinner"></i>
          <span>Cargando nombres de ciudades...</span>
        </div>
        
        <!-- Lista de segmentos solo cuando las ciudades estén cargadas -->
        <ul *ngIf="citiesLoaded" class="flight-segments-list">
          <li *ngFor="let seg of getFlightSegments()" class="flight-segment-item">
            <div class="segment-info">
              <div class="segment-route">
                <div class="departure-info">
                  <div class="time-city-row">
                    <span class="time">{{ formatTime(seg.departureTime) }}</span>
                    <span class="city-name">{{ seg.departureCity }}</span>
                  </div>
                  <span class="airport-code">({{ seg.departureIata }})</span>
                </div>
                <span class="route-arrow">→</span>
                <div class="arrival-info">
                  <div class="time-city-row">
                    <span class="time">{{ formatTime(seg.arrivalTime) }}</span>
                    <span class="city-name">{{ seg.arrivalCity }}</span>
                  </div>
                  <span class="airport-code">({{ seg.arrivalIata }})</span>
                </div>
              </div>
              <div class="flight-number" *ngIf="seg.flightNumber">
                Vuelo: {{ seg.flightNumber }}
              </div>
            </div>
          </li>
        </ul>
      </div>
    </p-popover>
  </div>