<div class="traveler-selector">
  <div class="step">
    <div class="step-title">Agrega los viajeros y las habitaciones</div>
  </div>

  <h3 class="traveler-selector-title">Número de pasajeros</h3>

  <!-- Error message -->
  <div *ngIf="error && !loading" class="messages">
    <div class="error-message">
      <i class="pi pi-exclamation-triangle"></i>
      <p>{{ error }}</p>
    </div>
  </div>

  <!-- Mostrar loading spinner solo cuando loadingAgeGroups es true -->
  <div class="loading-container" *ngIf="loadingAgeGroups">
    <i class="pi pi-spin pi-spinner"></i>
    <span>Cargando grupos de edad...</span>
  </div>

  <!-- Selector siempre visible, solo se deshabilita durante loading -->
  <div class="traveler-selector-wrap" *ngIf="!loadingAgeGroups">
    <div
      class="traveler-selector-wrap-item"
      *ngFor="let ageGroup of orderedAgeGroups; trackBy: trackByAgeGroup"
    >
      <div class="traveler-selector-wrap-item-group">
        <span class="traveler-selector-wrap-item-name">{{
          ageGroup.name
        }}</span>
        <span class="traveler-selector-wrap-item-description">
          {{ getAgeRangeText(ageGroup) }}
        </span>
      </div>
      <p-inputNumber
        [ngModel]="getCountForAgeGroup(ageGroup.id)"
        (ngModelChange)="handlePassengersForAgeGroup(ageGroup.id, $event)"
        [showButtons]="true"
        buttonLayout="horizontal"
        spinnerMode="horizontal"
        [min]="getMinForAgeGroup(ageGroup.id)"
        [max]="getMaxForAgeGroup(ageGroup.id)"
        placeholder="0"
        [disabled]="loading"
        [class.input-error]="
          adultsErrorMsg && ageGroup.id === orderedAgeGroups[0]?.id
        "
        [class.input-warning]="
          ageGroup.id === orderedAgeGroups[0]?.id &&
          getCountForAgeGroup(ageGroup.id) === 0
        "
      >
        <ng-template #incrementbuttonicon>
          <span class="pi pi-chevron-up"></span>
        </ng-template>
        <ng-template #decrementbuttonicon>
          <span class="pi pi-chevron-down"></span>
        </ng-template>
      </p-inputNumber>
    </div>
  </div>

  <!-- Messages -->
  <div class="messages">
    <div *ngIf="adultsErrorMsg" class="error-message">
      <i class="pi pi-info-circle"></i>
      <p>{{ adultsErrorMsg }}</p>
    </div>
    <!-- Mensaje de advertencia por exceso de niños -->
    <div *ngIf="hasMoreThanOneChildPerAdult()" class="children-warning-message">
      <p-message icon="pi pi-exclamation-triangle" severity="warn" [closable]="false">
        <div>
          <p style="margin-bottom: 8px;">Hay más de un niño por adulto en esta reserva. Por favor, contacte con <strong>atención al cliente</strong> para continuar.</p>
          <div style="margin-top: 8px; font-size: 0.9em;">
            <div><strong>Teléfono:</strong> +34 91 123 45 67</div>
            <div><strong>Email:</strong> info&#64;differentroads.com</div>
          </div>
        </div>
      </p-message>
    </div>
  </div>
</div>
