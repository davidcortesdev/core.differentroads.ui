<div class="checkout">
  <h2 class="checkout-title">
    {{ tourName }}
  </h2>
  <p class="checkout-subtitle">
    {{ tourDates }}
  </p>
  <div class="checkout-container">
    <!-- Left and Center columns with steps -->
    <div class="main-content">
      <div class="steps-container full-width">
        <!-- Ubicando el p-steps donde estaba originalmente pero con clase full-width -->
        <p-steps [model]="items" [readonly]="false" [activeIndex]="activeIndex"
          (activeIndexChange)="onActiveIndexChange($event)"></p-steps>

        <div [ngSwitch]="activeIndex">
          <!-- Step 1: Customize Trip -->
          <div *ngSwitchCase="0">
            <app-customize-trip *ngIf="orderDetails && prices" [orderDetails]="orderDetails"
              [prices]="prices"></app-customize-trip>
            <div class="flex pt-6 justify-end">
              <p-button class="next" label="Continuar" icon="pi pi-arrow-right" iconPos="right"
                (onClick)="nextStepWithValidation(1)"></p-button>
            </div>
          </div>

          <!-- Step 2: Flights -->
          <div *ngSwitchCase="1">
            <app-flights *ngIf="orderDetails && prices" [orderDetails]="orderDetails"></app-flights>
            <div class="flight-buttons">
              <p-button class="without-flight" *ngIf="flightlessOption" label="Lo quiero sin vuelos" (onClick)="
                  checkAuthAndContinue(2, onActiveIndexChange.bind(this), true)
                "></p-button>
              <p-button class="continue-button" label="Continuar" icon="pi pi-arrow-right" iconPos="right" (onClick)="
                  checkAuthAndContinue(2, onActiveIndexChange.bind(this), false)
                " [disabled]="
                  !selectedFlight ||
                  selectedFlight.name.toLowerCase().includes('sin ')
                "></p-button>
            </div>
          </div>

          <!-- Step 3: Travelers -->
          <div *ngSwitchCase="2">
            <app-travelers></app-travelers>
            <div class="flex pt-6 justify-between">
              <p-button label="Continuar" icon="pi pi-arrow-right" iconPos="right"
                (onClick)="nextStepWithValidation(3)"></p-button>
            </div>
          </div>

          <!-- Step 4: Payment -->
          <div *ngSwitchCase="3">
            <app-payment 
              [totalPrice]="total"
              [subtotalPrice]="subtotal" 
              [processBooking]="processBooking.bind(this)"
              [departureDate]="periodData.dayOne || null" 
              (goBackEvent)="onActiveIndexChange(2)"
              [tourName]="tourName">
            </app-payment>
          </div>
        </div>
      </div>
      <!-- Tour additional info component with all required inputs -->
      <div class="tour-actions-container">
        <app-tour-additional-info
          [existingOrder]="orderDetails"
          [tourName]="tourName"
          [periodName]="periodData.name || ''"
          [periodDates]="tourDates"
          [selectedFlight]="selectedFlight"
          [travelersSelected]="{
            adults: travelersSelected.adults,
            childs: travelersSelected.childs,
            babies: travelersSelected.babies
          }"
          [periodID]="periodID"
          [isAuthenticated]="isAuthenticated"
        ></app-tour-additional-info>
      </div>
    </div>

    <!-- Right column - Order Summary and Discount Code -->
    <div class="right-column">
      <!-- Order Summary Section -->
      <app-summary-table 
        [summary]="summary" 
        [subtotal]="subtotal" 
        [total]="total" 
        [isAuthenticated]="isAuthenticated"
        [selectedFlight]="selectedFlight" 
        [showPointsSection]="true" 
        [showTotalSection]="true"
        [showFlightSection]="true" 
        [currency]="'EUR'" 
        [title]="'Resumen del pedido'">
      </app-summary-table>
      
      <app-discount-code 
        [orderTotal]="subtotal" 
        [existingDiscount]="discountInfo"
        (discountApplied)="handleDiscountApplied($event)">
      </app-discount-code>
    </div>
  </div>

  <!-- Login modal para manejar la autenticaciÃ³n -->
  <app-login-modal 
    [visible]="loginDialogVisible" 
    (close)="closeLoginModal()" 
    (login)="navigateToLogin()"
    (register)="navigateToRegister()">
  </app-login-modal>
</div>