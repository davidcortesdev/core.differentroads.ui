<!-- Título de salida fuera del flight-itinerary -->
<div class="flight-departure-title" *ngIf="journeys && journeys.length > 0">
  <h3>Salida {{ journeys[0].segments[0].departureCity }} ({{ journeys[0].departure.iata }})</h3>
</div>

<div class="flight-itinerary">
  <div class="flight-itinerary-journey">
    <!-- Iteramos sobre cada journey (outbound e inbound) -->
    <div class="journey-item" *ngFor="let journey of journeys; let i = index">
      <span class="journey-item-departure-text">
        <span class="direction-text small">{{ i === 0 ? "IDA" : "VUELTA" }}</span>
        <span class="route-text-empty"></span>
      </span>

      <div class="journey-item-departure pr-2">
        <span class="journey-item-departure-time">
          {{
            isValidDate(journey.departure.time)
              ? (journey.departure.time | date : "HH:mm" : "UTC")
              : "--:--"
          }}
        </span>
        <span class="journey-item-departure-date">
          {{
            isValidDate(journey.departure.date)
              ? (journey.departure.date | date : "dd-MM-yyyy" : "UTC")
              : "--/--/----"
          }}
        </span>
        <span class="journey-item-departure-city">{{ journey.segments[0].departureCity }} <strong>({{ journey.departure.iata }})</strong></span>
      </div>

      <div class="journey-item-flight-info space-y-2">
        <p-overlayPanel #op>
          <p style="color: var(--background-azul); font-weight: 500; margin-bottom: 1rem;">Detalle del vuelo</p>
          <p-timeline [value]="journey.timelineData" align="left">
            <ng-template #opposite let-item>
              <i
                [class]="
                  item.type === 'departure' ? 'pi pi-send' : 'pi pi-map-marker'
                "
              ></i>
            </ng-template>
            <ng-template let-item pTemplate="content">
              <span *ngIf="item.type === 'departure'">
                {{
                  isValidDate(item.departureDateTime)
                    ? (item.departureDateTime | date : "HH:mm" : "UTC")
                    : item.departureDateTime
                    ? (item.departureDateTime.toString() | slice : 16 : 21)
                    : "--:--"
                }}
                {{ item.departureCity || "Unknown City" }} ({{
                  item.departureIata || "???"
                }})
                <br />
                {{
                  isValidDate(item.departureDateTime)
                    ? (item.departureDateTime | date : "dd-MM-yyyy" : "UTC")
                    : (journey.departure.date | date : "dd-MM-yyyy" : "UTC")
                }}
                {{ item.flightNumber || "No flight number" }}
              </span>
              <span *ngIf="item.type === 'arrival'">
                {{
                  isValidDate(item.arrivalDateTime)
                    ? (item.arrivalDateTime | date : "HH:mm" : "UTC")
                    : item.arrivalDateTime
                    ? (item.arrivalDateTime.toString() | slice : 16 : 21)
                    : "--:--"
                }}
                {{ item.arrivalCity || "Unknown City" }} ({{
                  item.arrivalIata || "???"
                }})
                <br />
                {{
                  isValidDate(item.arrivalDateTime)
                    ? (item.arrivalDateTime | date : "dd-MM-yyyy" : "UTC")
                    : (journey.arrival.date | date : "dd-MM-yyyy" : "UTC")
                }}
                {{ item.flightNumber || "No flight number" }}
              </span>
            </ng-template>
          </p-timeline>
        </p-overlayPanel>

        <span
          class="journey-item-flight-info-segments"
          (click)="op.toggle($event)"
          style="
            cursor: pointer;
            text-decoration: underline;
            color: var(--p-primary-color);
          "
        >
          {{ journey.stopsText }}
        </span>
        <span class="journey-item-flight-info-aeroline">
          {{ journey.airlineName }}
        </span>
        <span class="journey-item-flight-info-flight-hours">
          {{ journey.totalDuration }}
        </span>
      </div>

      <div class="journey-item-departure pl-2">
        <span class="journey-item-departure-time">
          {{
            isValidDate(journey.arrival.time)
              ? (journey.arrival.time | date : "HH:mm" : "UTC")
              : "--:--"
          }}
        </span>
        <span class="journey-item-departure-date">
          {{
            isValidDate(journey.arrival.date)
              ? (journey.arrival.date | date : "dd-MM-yyyy" : "UTC")
              : "--/--/----"
          }}
        </span>
        <span class="journey-item-departure-city">{{ journey.segments[journey.segments.length - 1].arrivalCity }} <strong>({{ journey.arrival.iata }})</strong></span>
      </div>
    </div>
  </div>

  <!-- Bloque de precios y botón de selección -->
  <div class="flight-itinerary-price space-y-4">
    <div class="flight-itinerary-price-wrapper">
      <span class="flight-itinerary-price-wrapper-price">
        {{ getPrice() || flight.price || 0 | currencyFormat : "EUR" }}
      </span>
      <span class="flight-itinerary-price-wrapper-text">Por persona</span>
    </div>
    <p-button
  type="button"
  class="button-rounded is-primary px-6 py-3"
  [styleClass]="isFlightSelected(flight) ? 'selected-flight-button' : ''"
  (click)="selectFlight(flight)"
>
  {{ isFlightSelected(flight) ? "Seleccionado" : "Seleccionar" }}
</p-button>
  </div>
</div>