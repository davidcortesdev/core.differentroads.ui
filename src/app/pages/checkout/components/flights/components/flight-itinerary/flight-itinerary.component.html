<div class="flight-itinerary">
  <div class="flight-itinerary-journey">
    <!-- Iteramos sobre cada journey (outbound e inbound) -->
    <div class="journey-item" *ngFor="let journey of journeys; let i = index">
      <div class="journey-item-departure pr-2">
        <span class="journey-item-departure-text">
          <span class="direction-text">{{ i === 0 ? 'IDA' : 'VUELTA' }}</span>
          <span class="route-text">
            <strong>
            {{ journey.segments[0].departureCity }} ({{ journey.departure.iata }}) - 
            {{ journey.segments[0].arrivalCity }} ({{ journey.arrival.iata }})
          </strong>
          </span>
        </span>
        <div>
          <span class="journey-item-departure-title">Salida:</span>
          <span class="journey-item-departure-country">
            {{ journey.departure.iata }}
          </span>
        </div>
        <span class="journey-item-departure-time">
          {{ journey.departure.time | date : "HH:mm" : "UTC" }}
        </span>
        <span class="journey-item-departure-date">
          {{ journey.departure.date | date : "dd-MM-yyyy" : "UTC" }}
        </span>
      </div>

      <div class="journey-item-flight-info space-y-2">
        <!-- Cada journey tiene su overlay panel para mostrar el timeline -->
        <p-overlayPanel #op>
          <p>Detalle del vuelo</p>
          <p-timeline
            [value]="journey.timelineData"
            align="left"
          >
            <ng-template #opposite let-item>
              <i [class]="item.type === 'departure' ? 'pi pi-send' : 'pi pi-map-marker'"></i>
            </ng-template>
            <ng-template let-item pTemplate="content">
              <span *ngIf="item.type === 'departure'">
                {{ item.departureDateTime | date : "HH:mm" : "UTC" }} {{ item.departureCity }}   ({{ item.departureIata }})
                <br>
                {{ item.departureDateTime | date : "dd-MM-yyyy" : "UTC" }} {{ journey.segments[0].flightNumber }} 
                
              </span>
              <span *ngIf="item.type === 'arrival'">
                {{ item.arrivalDateTime | date : "HH:mm" : "UTC" }} {{ item.arrivalCity }} ({{ item.arrivalIata }})
                {{ item.arrivalDateTime | date : "dd-MM-yyyy" : "UTC" }} {{ journey.segments[0].flightNumber }}
              </span>
            </ng-template>
          </p-timeline>
        </p-overlayPanel>

        <span
          class="journey-item-flight-info-segments"
          (click)="op.toggle($event)"
          style="
            cursor: pointer;
            text-decoration: underline;
            color: var(--p-primary-color);
          "
        >
          {{ journey.stopsText }}
        </span>
        <span class="journey-item-flight-info-aeroline">
          {{ journey.airlineName }}
        </span>
        <span class="journey-item-flight-info-flight-hours">
          {{ journey.totalDuration }}
        </span>
      </div>

      <div class="journey-item-departure pl-2">
        <span class="journey-item-departure-text-invisible">{{ i === 0 ? 'IDA' : 'VUELTA' }}</span>
        <div>
          <span class="journey-item-departure-title">Llegada:</span>
          <span class="journey-item-departure-country">
            {{ journey.arrival.iata }}
          </span>
        </div>
        <span class="journey-item-departure-time">
          {{ journey.arrival.time | date : "HH:mm" : "UTC" }}
        </span>
        <span class="journey-item-departure-date">
          {{ journey.arrival.date | date : "dd-MM-yyyy" : "UTC" }}
        </span>
      </div>
    </div>
  </div>

  <!-- Bloque de precios y botón de selección -->
  <div class="flight-itinerary-price space-y-4">
    <div class="flight-itinerary-price-wrapper">
      <span class="flight-itinerary-price-wrapper-name">
        {{ flight.name }}
      </span>
      <span class="flight-itinerary-price-wrapper-price">
        {{ getPrice() || flight.price || 0 | currencyFormat : "EUR" }}
      </span>
      <span class="flight-itinerary-price-wrapper-text">Por persona</span>
    </div>
    <p-button
      type="button"
      class="button-rounded is-primary px-6 py-3"
      (click)="selectFlight(flight)"
    >
      {{ isFlightSelected(flight) ? "Seleccionado" : "Seleccionar" }}
    </p-button>
  </div>
</div>
