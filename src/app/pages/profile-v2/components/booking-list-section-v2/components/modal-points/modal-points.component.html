<!-- Modal para descuento de puntos -->
<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  [style]="{width: '500px'}"
  header="Descontar Puntos"
  (onHide)="closeModal()">
  
  <div class="points-discount-content" *ngIf="bookingItem">
    <div class="booking-info">
      <h4>{{ bookingItem.title }}</h4>
      <p><strong>Nº Reserva:</strong> {{ bookingItem.reservationNumber || bookingItem.number }}</p>
      <p><strong>Precio Total:</strong> {{ bookingItem.price | currency:'EUR':'symbol':'1.2-2' }}</p>
    </div>
    
    <div class="points-section">
      <div class="points-available">
        <label><strong>Puntos Disponibles:</strong></label>
        <span class="points-value">{{ availablePoints }}</span>
      </div>
      
      <p-message severity="info" styleClass="w-full membership-message">
        <ng-template pTemplate="messageicon">
          <i class="pi pi-star-fill"></i>
        </ng-template>
        <span><strong>{{ getCategoryDisplayName() }}</strong> : Límite por reserva: <strong>{{ maxPointsForCategory }} puntos</strong></span>
      </p-message>
      
      <div class="points-input">
        <label for="pointsToUse">Puntos a Descontar:</label>
        <p-inputNumber 
          id="pointsToUse"
          [(ngModel)]="pointsToUse" 
          [min]="0" 
          [max]="maxPointsForCategory"
          [maxFractionDigits]="0"
          [useGrouping]="false"
          [minFractionDigits]="0"
          [showButtons]="false"
          mode="decimal"
          placeholder="Ingresa los puntos a descontar"
          styleClass="w-full"
          inputStyleClass="points-input-field"
          (ngModelChange)="validatePointsInput()">
        </p-inputNumber>
      </div>
      
      <div class="discount-calculation" *ngIf="pointsToUse > 0">
        <div class="calculation-row">
          <span>Precio Original:</span>
          <span>{{ bookingItem.price | currency:'EUR':'symbol':'1.2-2' }}</span>
        </div>
        <div class="calculation-row">
          <span>Descuento por Puntos:</span>
          <span class="discount-amount">-{{ pointsToUse | currency:'EUR':'symbol':'1.2-2' }}</span>
        </div>
        <div class="calculation-row total">
          <span><strong>Precio Final:</strong></span>
          <span><strong>{{ getFinalPrice() | currency:'EUR':'symbol':'1.2-2' }}</strong></span>
        </div>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      icon="pi pi-times" 
      styleClass="p-button-text" 
      (click)="closeModal()">
    </p-button>
    <p-button 
      label="Aplicar Puntos" 
      icon="pi pi-check" 
      styleClass="p-button-success" 
      [disabled]="!isApplyDiscountButtonEnabled()"
      (click)="applyPointsDiscount()">
    </p-button>
  </ng-template>
</p-dialog>

<!-- Modal de confirmación para aplicar puntos -->
<p-dialog 
  [(visible)]="confirmationModalVisible" 
  [modal]="true" 
  [closable]="true" 
  [draggable]="false" 
  [resizable]="false"
  [style]="{width: '450px'}"
  header="Confirmar Aplicación de Puntos">
  
  <div class="confirmation-content">
    <div class="warning-message">
      <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: #ee5a24; margin-bottom: 1rem;"></i>
      <p><strong>¿Estás seguro de que deseas aplicar {{ pointsToUse }} puntos?</strong></p>
      <p style="margin-top: 1rem;">Una vez aplicados los puntos, no podrás revertir esta acción.</p>
      <p style="margin-top: 0.5rem; color: #6b7280;">El descuento se aplicará inmediatamente a tu reserva.</p>
    </div>
    
    <div class="points-summary" *ngIf="bookingItem">
      <div class="summary-row">
        <span>Puntos a aplicar:</span>
        <strong>{{ pointsToUse }}</strong>
      </div>
      <div class="summary-row">
        <span>Descuento:</span>
        <strong>{{ pointsToUse | currency:'EUR':'symbol':'1.2-2' }}</strong>
      </div>
      <div class="summary-row total">
        <span>Precio final:</span>
        <strong>{{ getFinalPrice() | currency:'EUR':'symbol':'1.2-2' }}</strong>
      </div>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      icon="pi pi-times" 
      styleClass="p-button-text" 
      (click)="closeConfirmationModal()">
    </p-button>
    <p-button 
      label="Confirmar y Aplicar" 
      icon="pi pi-check" 
      styleClass="p-button-success" 
      (click)="confirmApplyPointsDiscount()">
    </p-button>
  </ng-template>
</p-dialog>

