<div class="view-profile-container">
  <p-panel class="avatar-panel">
    <div class="avatar-name-section">
      <p-avatar
      [icon]="personalInfo.avatarUrl != '' ? '' : 'pi pi-user'"
      [image]="personalInfo.avatarUrl || ''"
        size="xlarge"
        shape="circle"
        [style]="{ width: '100px', height: '100px' }"
      ></p-avatar>
      <h3>{{ personalInfo.nombre}} {{personalInfo.apellido}}</h3>
    </div>
  </p-panel>

  <p-panel class="datos-panel">
    <div class="update-profile-container">
      <!-- Mensajes de estado -->
      <div *ngIf="errorMessage" class="error-message">
        <p-message severity="error" [text]="errorMessage"></p-message>
      </div>
      
      <div *ngIf="successMessage" class="success-message">
        <p-message severity="success" [text]="successMessage"></p-message>
      </div>
      
      <form class="profile-form">
        <!-- Sección de Avatar -->
        <div class="form-field">
          <p-iftalabel>Adjuntar foto</p-iftalabel>
          
          <!-- Indicador de carga de imagen -->
          <div *ngIf="isUploadingImage" class="upload-loading">
            <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="4"></p-progressSpinner>
            <span>Subiendo imagen...</span>
          </div>
          
          <p-fileUpload
            *ngIf="!isUploadingImage"
            chooseIcon="pi pi-upload"
            mode="advanced"
            [maxFileSize]="maxFileSize"
            accept="image/jpeg,image/jpg,image/png,image/webp"
            [auto]="true"
            (onSelect)="onUpload($event)"
            [showUploadButton]="false"
            [showCancelButton]="false"
            chooseLabel="Adjuntar foto"
            (onRemove)="onRemoveImage()"
            styleClass="custom-upload"
            severity="danger"
          >
            <ng-template #content let-files>
              <div class="upload-list" *ngIf="uploadedFiles.length">
                <div class="file-item" *ngFor="let file of uploadedFiles">
                  <span class="file-name">{{ file.name }}</span>
                </div>
              </div>
            </ng-template>
          </p-fileUpload>
        </div>

        <!-- Datos de Contacto -->
        <p-floatlabel variant="on">
          <input
            pInputText
            id="nombre"
            [(ngModel)]="personalInfo.nombre"
            name="nombre"
            (input)="onNombreInput($event)"
            [class.error]="hasFieldError('nombre')"
          />
          <label for="nombre">Nombre</label>
          <small class="error-message" *ngIf="hasFieldError('nombre')">
            {{ getFieldError('nombre') }}
          </small>
        </p-floatlabel>

        <p-floatlabel variant="on">
          <input
            pInputText
            id="apellido"
            [(ngModel)]="personalInfo.apellido"
            name="apellido"
            (input)="onApellidoInput($event)"
            [class.error]="hasFieldError('apellido')"
          />
          <label for="apellido">Apellido</label>
          <small class="error-message" *ngIf="hasFieldError('apellido')">
            {{ getFieldError('apellido') }}
          </small>
        </p-floatlabel>


        <p-floatlabel variant="on">
          <input
            pInputText
            id="email"
            [(ngModel)]="personalInfo.email"
            name="email"
            (input)="onEmailInput($event)"
            [class.error]="hasFieldError('email')"
          />
          <label for="email">Email</label>
          <small class="error-message" *ngIf="hasFieldError('email')">
            {{ getFieldError('email') }}
          </small>
        </p-floatlabel>

        <p-floatlabel variant="on">
          <input
            pInputText
            id="telefono"
            [(ngModel)]="personalInfo.telefono"
            name="telefono"
            (input)="onTelefonoInput($event)"
            [class.error]="hasFieldError('telefono')"
            styleClass="p-inputtext-sm"
          />
          <label for="telefono">Teléfono</label>
          <small class="error-message" *ngIf="hasFieldError('telefono')">
            {{ getFieldError('telefono') }}
          </small>
        </p-floatlabel>

        <!-- Datos Personales -->
        <p-floatlabel variant="on">
          <p-datepicker 
            inputId="fechaNacimiento"
            name="fechaNacimiento"
            [(ngModel)]="personalInfo.fechaNacimiento"
            showIcon
            iconDisplay="input"
            (onSelect)="onFechaNacimientoChange($event)"
            [class.error]="hasFieldError('fechaNacimiento')"/>
          <label for="fechaNacimiento">Fecha de nacimiento</label>
          <small class="error-message" *ngIf="hasFieldError('fechaNacimiento')">
            {{ getFieldError('fechaNacimiento') }}
          </small>
      </p-floatlabel>

        <p-floatlabel class="w-full md:w-56" variant="on">
          <p-select 
            [(ngModel)]="personalInfo.sexo" 
            name="sexo"
            inputId="sexo" 
            [options]="sexoOptions" 
            optionLabel="label"
            optionValue="value"
            (onChange)="onSexoChange($event)"
            [class.error]="hasFieldError('sexo')"
            styleClass="w-full" />
          <label for="sexo">Sexo</label>
          <small class="error-message" *ngIf="hasFieldError('sexo')">
            {{ getFieldError('sexo') }}
          </small>
        </p-floatlabel>
        

        <p-floatlabel variant="on">
          <input
            pInputText
            id="dni"
            [(ngModel)]="personalInfo.dni"
            name="dni"
            (input)="onDniInput($event)"
            [class.error]="hasFieldError('dni')"
          />
          <label for="dni">DNI/NIE</label>
          <small class="error-message" *ngIf="hasFieldError('dni')">
            {{ getFieldError('dni') }}
          </small>
        </p-floatlabel>

        <!-- Dirección -->
        <p-floatlabel variant="on">
          <input
            pInputText
            id="direccion"
            [(ngModel)]="personalInfo.direccion"
            name="direccion"
            (input)="onDireccionInput($event)"
          />
          <label for="direccion">Dirección</label>
        </p-floatlabel>

        <p-floatlabel variant="on">
          <input
            pInputText
            id="ciudad"
            [(ngModel)]="personalInfo.ciudad"
            name="ciudad"
            (input)="onCiudadInput($event)"
          />
          <label for="ciudad">Ciudad</label>
        </p-floatlabel>

        <p-floatlabel variant="on">
          <input
            pInputText
            id="codigoPostal"
            [(ngModel)]="personalInfo.codigoPostal"
            name="codigoPostal"
            (input)="onCodigoPostalInput($event)"
            [class.error]="hasFieldError('codigoPostal')"
          />
          <label for="codigoPostal">Código postal</label>
          <small class="error-message" *ngIf="hasFieldError('codigoPostal')">
            {{ getFieldError('codigoPostal') }}
          </small>
        </p-floatlabel>

        <p-floatlabel variant="on">
          <input
            pInputText
            id="pais"
            [(ngModel)]="personalInfo.pais"
            name="pais"
            (input)="onPaisInput($event)"
          />
          <label for="pais">País</label>
        </p-floatlabel>

        <!-- Notas -->
        <p-floatlabel variant="on">
          <textarea
            pTextarea
            id="notas"
            [(ngModel)]="personalInfo.notas"
            name="notas"
            rows="3"
            (input)="onNotasInput($event)"
            styleClass="p-inputtext-sm"
          ></textarea>
          <label for="notas">Notas</label>
        </p-floatlabel>

      <!-- Botones -->
      <div class="button-container">
        <div class="btn-save">
          <p-button
            [label]="isSaving ? 'Guardando...' : 'Guardar'"
            styleClass="p-button-primary"
            [loading]="isSaving"
            [disabled]="isSaving"
            (onClick)="onSubmit()"
          >
          </p-button>
        </div>
        <div class="btn-cancel">
          <p-button
            label="Cancelar"
            styleClass="p-button-text"
            (onClick)="onCancel()"
          >
          </p-button>
        </div>
      </div>
    </form>
  </div>
</p-panel>

</div>