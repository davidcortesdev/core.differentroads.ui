<div class="view-profile-container">
  <p-panel class="avatar-panel">
    <div class="avatar-name-section">
      <p-avatar
      [icon]="personalInfo.avatarUrl != '' ? '' : 'pi pi-user'"
      [image]="personalInfo.avatarUrl || ''"
        size="xlarge"
        shape="circle"
        [style]="{ width: '100px', height: '100px' }"
      ></p-avatar>
      <h3>{{ personalInfo.nombre}} {{personalInfo.apellido}}</h3>
    </div>
  </p-panel>

  <p-panel class="datos-panel">
    <div class="update-profile-container">
      <!-- Mensajes de estado -->
      <div *ngIf="errorMessage" class="error-message">
        <p-message severity="error" [text]="errorMessage"></p-message>
      </div>
      
      <div *ngIf="successMessage" class="success-message">
        <p-message severity="success" [text]="successMessage"></p-message>
      </div>
      
      <form class="profile-form">
        <!-- Sección de Avatar -->
        <div class="form-field">
          <label>Adjuntar foto</label>
          <p-fileUpload
            chooseIcon="pi pi-upload"
            mode="advanced"
            [maxFileSize]="maxFileSize"
            accept="image/jpeg,image/jpg,image/png,image/webp"
            [auto]="true"
            (onSelect)="onUpload($event)"
            [showUploadButton]="false"
            [showCancelButton]="false"
            chooseLabel="Adjuntar foto"
            (onRemove)="uploadedFiles = []"
            styleClass="custom-upload"
          >
            <ng-template pTemplate="content" let-files>
              <div class="upload-list" *ngIf="uploadedFiles.length">
                <div class="file-item" *ngFor="let file of uploadedFiles">
                  <span class="file-name">{{ file.name }}</span>
                </div>
              </div>
            </ng-template>
          </p-fileUpload>
        </div>

        <!-- Datos de Contacto -->
        <div class="form-field">
          <label>Nombre:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.nombre"
            name="nombre"
            placeholder="Ingrese su nombre"
            (input)="onNombreInput($event)"
            [class.error]="hasFieldError('nombre')"
          />
          <small class="error-message" *ngIf="hasFieldError('nombre')">
            {{ getFieldError('nombre') }}
          </small>
        </div>

        <div class="form-field">
          <label>Apellido:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.apellido"
            name="apellido"
            placeholder="Ingrese su apellido"
            (input)="onApellidoInput($event)"
            [class.error]="hasFieldError('apellido')"
          />
          <small class="error-message" *ngIf="hasFieldError('apellido')">
            {{ getFieldError('apellido') }}
          </small>
        </div>

        <div class="form-field">
          <label>Email:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.email"
            name="email"
            placeholder="Ingrese su email"
            (input)="onEmailInput($event)"
            [class.error]="hasFieldError('email')"
          />
          <small class="error-message" *ngIf="hasFieldError('email')">
            {{ getFieldError('email') }}
          </small>
        </div>

        <div class="form-field">
          <label>Teléfono:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.telefono"
            name="telefono"
            placeholder="Ingrese su teléfono"
            (input)="onTelefonoInput($event)"
            [class.error]="hasFieldError('telefono')"
            styleClass="p-inputtext-sm"
          />
          <small class="error-message" *ngIf="hasFieldError('telefono')">
            {{ getFieldError('telefono') }}
          </small>
        </div>

        <!-- Datos Personales -->
        <div class="form-field">
          <label>Fecha de nacimiento:</label>
          <p-datepicker 
            [(ngModel)]="personalInfo.fechaNacimiento"
            name="fechaNacimiento"
            dateFormat="dd/mm/yy"
            placeholder="Seleccione una fecha"
            styleClass="p-datepicker -sm custom-calendar"
            [showIcon]="true"
            (onSelect)="onFechaNacimientoChange($event)"
            [class.error]="hasFieldError('fechaNacimiento')"
          >
          </p-datepicker >
          <small class="error-message" *ngIf="hasFieldError('fechaNacimiento')">
            {{ getFieldError('fechaNacimiento') }}
          </small>
        </div>

        <div class="form-field">
          <label>DNI/NIE:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.dni"
            name="dni"
            placeholder="Ingrese su DNI/NIE"
            (input)="onDniInput($event)"
            [class.error]="hasFieldError('dni')"
          />
          <small class="error-message" *ngIf="hasFieldError('dni')">
            {{ getFieldError('dni') }}
          </small>
        </div>

        <!-- Dirección -->
        <div class="form-field">
          <label>Dirección:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.direccion"
            name="direccion"
            placeholder="Ingrese su dirección"
            (input)="onDireccionInput($event)"
          />
        </div>

        <div class="form-field">
          <label>Ciudad:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.ciudad"
            name="ciudad"
            placeholder="Ingrese su ciudad"
            (input)="onCiudadInput($event)"
          />
        </div>

        <div class="form-field">
          <label>Código postal:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.codigoPostal"
            name="codigoPostal"
            placeholder="Ingrese su código postal"
            (input)="onCodigoPostalInput($event)"
            [class.error]="hasFieldError('codigoPostal')"
          />
          <small class="error-message" *ngIf="hasFieldError('codigoPostal')">
            {{ getFieldError('codigoPostal') }}
          </small>
        </div>

        <div class="form-field">
          <label>País:</label>
          <input
            pInputText
            [(ngModel)]="personalInfo.pais"
            name="pais"
            placeholder="Ingrese su país"
            (input)="onPaisInput($event)"
          />
        </div>

        <!-- Notas -->
        <div class="form-field">
          <label>Notas:</label>
          <textarea
            pInputTextarea
            [(ngModel)]="personalInfo.notas"
            name="notas"
            placeholder="Notas adicionales"
            rows="3"
            (input)="onNotasInput($event)"
            styleClass="p-inputtext-sm"
          ></textarea>
        </div>

      <!-- Botones -->
      <div class="button-container">
        <div class="btn-save">
          <p-button
            [label]="isSaving ? 'Guardando...' : 'Guardar'"
            styleClass="p-button-primary"
            [loading]="isSaving"
            [disabled]="isSaving"
            (onClick)="onSubmit()"
          >
          </p-button>
        </div>
        <div class="btn-cancel">
          <p-button
            label="Cancelar"
            styleClass="p-button-text"
            (onClick)="onCancel()"
          >
          </p-button>
        </div>
      </div>
    </form>
  </div>
</p-panel>

</div>