<div class="active-bookings">
  <div class="booking-header" (click)="toggleContent()">
    <span>Presupuestos recientes</span>
    <i
      class="pi"
      [ngClass]="{
        'pi-chevron-down arrow-down': !isExpanded,
        'pi-chevron-up arrow-up': isExpanded
      }"
    ></i>
  </div>

  <div class="booking-content" [ngClass]="{ hidden: !isExpanded }">
    <!-- Loading indicator -->
    <div class="loading-container" *ngIf="loading">
      <p-progressSpinner strokeWidth="3" animationDuration=".5s"></p-progressSpinner>
    </div>
    
    <!-- Empty state message when no budgets are available -->
    <div class="empty-state" *ngIf="!loading && (!budgets || budgets.length === 0)">
      <p>No hay presupuestos recientes</p>
    </div>
    
    <!-- Content when not loading and budgets exist -->
    <p-dataView
      #dv
      [value]="budgets"
      [rows]="5"
      [paginator]="true"
      styleClass="transparent-dataview"
      *ngIf="!loading && budgets && budgets.length > 0"
    >
      <ng-template #list let-budgets>
        <div class="booking-list">
          <div class="booking-item" *ngFor="let budget of budgets">
            <div class="booking-item-content">
              <div class="image-container">
                <img [src]="budget.image" alt="Budget image" />
              </div>

              <div class="info-sections">
                <div class="title-section">
                  <h2>{{ budget.title }}</h2>
                </div>
                <div class="info-content">
                  <div class="info-row">
                    <span class="label">Nº Presupuesto:</span>
                    <span class="value budget">{{ budget.id }}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Fecha de creación:</span>
                    <span class="value">{{
                      budget.creationDate | date : "dd/MM/yyyy"
                    }}</span>
                  </div>
                </div>
              </div>

              <div class="info-right">
                <!-- In your HTML where you show the departure date -->
                <div class="departure-info">
                  <span>Salida: </span>
                  <strong>{{ budget.departureName || formatShortDate(budget.departureDate) }}</strong>                </div>
                <div class="passenger-price">
                  <span class="num-users">{{ budget.passengers }}</span>
                  <i class="pi pi-users"></i>
                  <strong>{{ budget.price | currencyFormat : "EUR" }}</strong>
                </div>
              </div>

              <div class="buttons">
                <div class="top-buttons">
                  <button
                    pButton
                    label="Descargar"
                    class="p-button-outlined"
                  ></button>
                  <button pButton label="Enviar" class="p-button sendbtn"></button>
                </div>
                <button
                  pButton
                  label="Reservar"
                  class="p-button-rounded"
                ></button>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </p-dataView>
  </div>
</div>
