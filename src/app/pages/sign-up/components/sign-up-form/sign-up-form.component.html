<div class="auth-card-container">
  <div class="auth-card-overlay"></div>
  <div class="auth-layout">
    <div class="sign-up-form">
      <h1 class="font-base font-medium sign-up-form-title" *ngIf="!isConfirming">
        Crear Cuenta en Different Roads
      </h1>

      <div *ngIf="!isConfirming">
        <p-button
          label="Iniciar sesión con Google"
          icon="pi pi-google"
          [loading]="isLoading"
          [disabled]="isLoading"
          (onClick)="signInWithGoogle()"
          variant="text"
          size="large"
          [rounded]="true"
          styleClass="btn-google"
        ></p-button>
      </div>

      <!-- Separador -->
      <p-divider align="center" *ngIf="!isConfirming">
        <span class="p-tag">O iniciar sesión de forma manual </span>
      </p-divider>

      <form
        *ngIf="!isConfirming"
        (ngSubmit)="onSubmit()"
        class="form-login"
        [formGroup]="signUpForm"
      >
        <!-- Campo de nombre -->
        <div class="input-group mt-4">
          <input
            type="text"
            id="firstName"
            pInputText
            formControlName="firstName"
            placeholder="Nombre"
            class="input-field"
            [ngClass]="{ 'p-invalid': signUpForm.get('firstName')?.errors }"
          />
          <small *ngIf="signUpForm.get('firstName')?.errors" class="p-error">
            {{ getErrorMessage('firstName', signUpForm.get('firstName')?.errors) }}
          </small>
        </div>

        <!-- Campo de apellido -->
        <div class="input-group mt-4">
          <input
            type="text"
            id="lastName"
            pInputText
            formControlName="lastName"
            placeholder="Apellido"
            class="input-field"
            [ngClass]="{ 'p-invalid': signUpForm.get('lastName')?.errors }"
          />
          <small *ngIf="signUpForm.get('lastName')?.errors" class="p-error">
            {{ getErrorMessage('lastName', signUpForm.get('lastName')?.errors) }}
          </small>
        </div>

        <!-- Campo de email -->
        <div class="input-group mt-4 col-span-2">
          <input
            type="email"
            id="email"
            pInputText
            formControlName="email"
            placeholder="Email"
            class="input-field"
            [ngClass]="{ 'p-invalid': signUpForm.get('email')?.errors }"
          />
          <small *ngIf="signUpForm.get('email')?.errors" class="p-error">
            {{ getErrorMessage('email', signUpForm.get('email')?.errors) }}
          </small>
        </div>

        <!-- Campo de teléfono con prefijo -->
        <div class="input-group mt-4 col-span-2">
          <div class="phone-row">
            <app-phone-prefix-select
              [(ngModel)]="selectedPhonePrefix"
              [ngModelOptions]="{standalone: true}"
              [phonePrefixOptions]="phonePrefixOptions"
              [placeholder]="'Seleccione prefijo'"
              [showClear]="true"
              [filter]="true"
              [styleClass]="'prefix-select'"
              [errorClass]="signUpForm.get('phonePrefix')?.errors && signUpForm.get('phonePrefix')?.touched ? 'p-invalid' : ''"
              (prefixChange)="onPhonePrefixChange($event)"
            ></app-phone-prefix-select>
            <input
              type="tel"
              id="phone"
              pInputText
              formControlName="phone"
              placeholder="Teléfono"
              class="input-field phone-input"
              [ngClass]="{ 'p-invalid': signUpForm.get('phone')?.errors }"
            />
          </div>
          <small *ngIf="signUpForm.get('phonePrefix')?.errors && signUpForm.get('phonePrefix')?.touched" class="p-error">
            {{ getErrorMessage('phonePrefix', signUpForm.get('phonePrefix')?.errors) }}
          </small>
          <small *ngIf="signUpForm.get('phone')?.errors" class="p-error">
            {{ getErrorMessage('phone', signUpForm.get('phone')?.errors) }}
          </small>
        </div>

        <!-- Campo de contraseña -->
        <div class="input-group mt-4">
          <p-password
            id="password"
            formControlName="password"
            [toggleMask]="true"
            [feedback]="false"
            placeholder="Contraseña"
            class="input-field"
            [ngClass]="{ 'p-invalid': signUpForm.get('password')?.errors }"
          ></p-password>
          <small *ngIf="signUpForm.get('password')?.errors" class="p-error">
            {{ getErrorMessage('password', signUpForm.get('password')?.errors) }}
          </small>
        </div>

        <!-- Campo de confirmar contraseña -->
        <div class="input-group mt-4">
          <p-password
            id="confirmPassword"
            formControlName="confirmPassword"
            [toggleMask]="true"
            [feedback]="false"
            placeholder="Confirmar Contraseña"
            class="input-field"
            [ngClass]="{ 'p-invalid': signUpForm.get('confirmPassword')?.errors }"
          ></p-password>
          <small *ngIf="signUpForm.get('confirmPassword')?.errors" class="p-error">
            {{ getErrorMessage('confirmPassword', signUpForm.get('confirmPassword')?.errors) }}
          </small>
        </div>

        <!-- Checkbox de política de privacidad -->
        <div class="input-group mt-4 col-span-2 privacy-policy-container">
          <div class="privacy-policy-wrapper">
            <p-checkbox
              formControlName="acceptPrivacyPolicy"
              inputId="acceptPrivacyPolicy"
              [binary]="true"
            ></p-checkbox>
            <label for="acceptPrivacyPolicy" class="privacy-policy-label">
              Acepto la <a href="/pages/politica-de-privacidad" target="_blank" class="privacy-policy-link">política de privacidad</a>
            </label>
          </div>
        </div>

        <!-- Botón de registro -->
        <p-button
          type="submit"
          label="Registrarse"
          [loading]="isLoading"
          [disabled]="isLoading"
          [rounded]="true"
          size="large"
          class="p-button-primary p-button-block mt-4 col-span-2"
        ></p-button>

        <p class="sign-up-form-link mt-4 col-span-2">
          <span class="sign-up-form-link-span"> ¿Ya tienes una cuenta?</span>
          <a (click)="redirectToLogin()">Inicia sesión aquí</a>
        </p>
      </form>

      <!-- Componente de Confirmación de Código -->
      <app-confirmation-code
        *ngIf="isConfirming"
        [username]="registeredUsername"
        [isLoading]="isLoading"
        [isRedirecting]="isRedirecting"
        [errorMessage]="errorMessage"
        [successMessage]="successMessage"
        (confirmSuccess)="onConfirmSuccess()"
        (loadingChange)="onLoadingChange($event)"
        (errorMessageChange)="onErrorMessageChange($event)"
        (successMessageChange)="onSuccessMessageChange($event)"
      ></app-confirmation-code>
    </div>
  </div>
</div>