<p-toast position="top-right"></p-toast>

<app-tour-date-selector
  [title]="title"
  [selectedDate]="selectedDate"
  [tripType]="tripType"
  [dateOptions]="dateOptions"
  [selectedOption]="selectedOption"
  [showPlaceholder]="showPlaceholder"
  [tagsOptions]="tagsOptions"
  (dateChange)="onDateChange($event)"
></app-tour-date-selector>

<!-- Updated panel controls with matching padding -->
<div class="panel-controls-container">
  <div class="panel-controls">
    <button pButton type="button" icon="pi pi-plus" class="p-button-rounded p-button-outlined" pTooltip="Expandir todos" tooltipPosition="top" (click)="expandAllPanels()"></button>
    <button pButton type="button" icon="pi pi-minus" class="p-button-rounded p-button-outlined" pTooltip="Contraer todos" tooltipPosition="top" (click)="collapseAllPanels()"></button>
  </div>
</div>

<div class="itinerary-container">
  <div class="timeline-section">
    <div class="card">
      <p-timeline
        [value]="itinerary"
        align="left"
        styleClass="customized-timeline"
      >
        <ng-template pTemplate="marker" let-event>
          <!-- Marcador del timeline clickeable con indicador visual de activo -->
          <span
            class="pi pi-map-marker"
            style="padding-top: 1rem; font-size: larger; cursor: pointer"
            [ngClass]="{ 'active-marker': !event.collapsed }"
            [attr.data-index]="itinerary.indexOf(event)"
            (click)="markerClicked($event)"
          ></span>
        </ng-template>
        <ng-template pTemplate="content" let-event>
          <app-tour-itinerary-panel
            #itineraryPanel
            [event]="event"
            [index]="itinerary.indexOf(event)"
            (addActivity)="onAddActivity($event)"
            (panelClick)="handlePanelClick($event)"
          ></app-tour-itinerary-panel>
        </ng-template>
      </p-timeline>
    </div>
  </div>
  <div class="map-section">
    <!-- Pasar el ID del tour al componente de mapa -->
    <app-tour-map [tourSlug]="tourId"></app-tour-map>
  </div>
</div>
